# TBC CLASS — DB 설계 상세 (MongoDB)

> 1단계 MVP 기준 | 기획 문서 DB 구조 기반  
> 문서 버전: 1.0 | 작성일: 2025-02-05

---

## 목차

1. [컬렉션 개요](#1-컬렉션-개요)
2. [컬렉션별 스키마 상세](#2-컬렉션별-스키마-상세)
3. [인덱스 정리](#3-인덱스-정리)
4. [관계 및 제약 요약](#4-관계-및-제약-요약)

---

## 1. 컬렉션 개요

| 컬렉션 | 설명 |
|--------|------|
| users | 통합 사용자 (admin / teacher / student / parent). 로그인 ID, 비밀번호 해시, 이름, 전화번호, 역할 |
| students | 학생 프로필. User 1:1, 학교·학년·반 배정 |
| parents | 학부모–학생 1:1 연결 |
| teachers | 강사 프로필. User 1:1 |
| classes | 반(Class) 마스터 |
| classTeachers | 반–강사 N:M 매핑 |
| courses | 과목(중등/고등 수학 세부 과목) 마스터 |
| lessons | 수업 단위(진도 단위). 반·과목 소속 |
| progress | 수업별 진도 기록. 학생–수업 1:1 |
| assignments | 과제. 수업 또는 반 소속 |
| assignmentCompletions | 과제 수행 여부. 학생–과제 |
| tests | 테스트. 반 소속 |
| testScores | 테스트 점수. 학생–테스트 |

---

## 2. 컬렉션별 스키마 상세

### 2.1 users

| 필드 | 타입 | Required | 설명 |
|------|------|----------|------|
| _id | ObjectId | ✅ | 기본 키 |
| role | string | ✅ | `admin` \| `teacher` \| `student` \| `parent` |
| loginId | string | ✅ | 로그인 ID (전화번호와 동일해도 됨) |
| passwordHash | string | ✅ | bcrypt 해시. 평문 저장 금지 |
| name | string | ✅ | 표시 이름 |
| phone | string | ❌ | 전화번호. 학생/학부모는 선택 입력 가능하나 기획상 필수 입력으로 등록됨 |
| createdAt | Date | ✅ | 생성 시각 |
| updatedAt | Date | ✅ | 수정 시각 |

- **비고**: student/parent는 등록 시 전화번호 미입력 시 loginId/password를 전화번호로 자동 설정하는 것은 **애플리케이션 로직**에서 처리. DB에는 해시·loginId만 저장.

---

### 2.2 students

| 필드 | 타입 | Required | 설명 |
|------|------|----------|------|
| _id | ObjectId | ✅ | 기본 키 |
| userId | ObjectId | ✅ | users._id (1:1). role=student 인 User |
| school | string | ✅ | 학교명 |
| grade | string | ✅ | 학년 (예: "중1", "고2") |
| classId | ObjectId | ❌ | classes._id. 반 배정 (미배정 시 null) |
| createdAt | Date | ✅ | 생성 시각 |
| updatedAt | Date | ✅ | 수정 시각 |

- **제약**: 한 학생은 MVP에서 한 반만 소속 (classId 1개).

---

### 2.3 parents

| 필드 | 타입 | Required | 설명 |
|------|------|----------|------|
| _id | ObjectId | ✅ | 기본 키 |
| userId | ObjectId | ✅ | users._id (1:1). role=parent 인 User |
| studentId | ObjectId | ✅ | students._id. 연결된 자녀 1명 (1:1) |
| createdAt | Date | ✅ | 생성 시각 |
| updatedAt | Date | ✅ | 수정 시각 |

- **제약**: 한 parent는 한 student만 연결. 한 student는 한 parent만 연결 (1:1).

---

### 2.4 teachers

| 필드 | 타입 | Required | 설명 |
|------|------|----------|------|
| _id | ObjectId | ✅ | 기본 키 |
| userId | ObjectId | ✅ | users._id (1:1). role=teacher 인 User |
| createdAt | Date | ✅ | 생성 시각 |
| updatedAt | Date | ✅ | 수정 시각 |

- **비고**: 강사 이름·로그인 ID·비밀번호는 User에 있음. Teacher는 확장용 메타만.

---

### 2.5 classes

| 필드 | 타입 | Required | 설명 |
|------|------|----------|------|
| _id | ObjectId | ✅ | 기본 키 |
| name | string | ✅ | 반 이름 |
| description | string | ❌ | 설명 |
| createdAt | Date | ✅ | 생성 시각 |
| updatedAt | Date | ✅ | 수정 시각 |

---

### 2.6 classTeachers (반–강사 N:M)

| 필드 | 타입 | Required | 설명 |
|------|------|----------|------|
| _id | ObjectId | ✅ | 기본 키 |
| classId | ObjectId | ✅ | classes._id |
| teacherId | ObjectId | ✅ | teachers._id |
| createdAt | Date | ✅ | 생성 시각 |

- **제약**: (classId, teacherId) 조합 유일.

---

### 2.7 courses (과목 마스터)

| 필드 | 타입 | Required | 설명 |
|------|------|----------|------|
| _id | ObjectId | ✅ | 기본 키 |
| name | string | ✅ | 과목명 (예: "중2 수학", "미적분") |
| level | string | ❌ | `middle` \| `high` 등. 중등/고등 구분 |
| createdAt | Date | ✅ | 생성 시각 |
| updatedAt | Date | ✅ | 수정 시각 |

---

### 2.8 lessons (수업 단위)

| 필드 | 타입 | Required | 설명 |
|------|------|----------|------|
| _id | ObjectId | ✅ | 기본 키 |
| classId | ObjectId | ✅ | classes._id |
| courseId | ObjectId | ✅ | courses._id |
| title | string | ✅ | 수업 제목 |
| lessonDate | Date | ✅ | 수업 일자 |
| order | number | ❌ | 정렬 순서 (같은 날 여러 수업 시) |
| createdAt | Date | ✅ | 생성 시각 |
| updatedAt | Date | ✅ | 수정 시각 |

---

### 2.9 progress (진도 기록)

| 필드 | 타입 | Required | 설명 |
|------|------|----------|------|
| _id | ObjectId | ✅ | 기본 키 |
| studentId | ObjectId | ✅ | students._id |
| lessonId | ObjectId | ✅ | lessons._id |
| content | string | ❌ | 진도 메모/내용 |
| completedAt | Date | ❌ | 완료 처리 시각 |
| createdAt | Date | ✅ | 생성 시각 |
| updatedAt | Date | ✅ | 수정 시각 |

- **제약**: (studentId, lessonId) 조합 유일. 한 학생이 한 수업에 대해 진도 1건.

---

### 2.10 assignments (과제)

| 필드 | 타입 | Required | 설명 |
|------|------|----------|------|
| _id | ObjectId | ✅ | 기본 키 |
| lessonId | ObjectId | ❌ | lessons._id. 수업 연동 과제. 없으면 반 단위 과제일 수 있음 |
| classId | ObjectId | ✅ | classes._id (반 단위 과제 확정용) |
| title | string | ✅ | 과제 제목 |
| dueDate | Date | ❌ | 제출 기한 |
| createdAt | Date | ✅ | 생성 시각 |
| updatedAt | Date | ✅ | 수정 시각 |

- **비고**: lessonId 있으면 “해당 수업 과제”, 없으면 “해당 반 과제”로 해석 가능. MVP에서는 lessonId 있을 때만 쓰거나, classId만으로 반 단위 과제로 통일해도 됨.

---

### 2.11 assignmentCompletions (과제 수행 여부)

| 필드 | 타입 | Required | 설명 |
|------|------|----------|------|
| _id | ObjectId | ✅ | 기본 키 |
| studentId | ObjectId | ✅ | students._id |
| assignmentId | ObjectId | ✅ | assignments._id |
| completed | boolean | ✅ | 완료 여부 |
| completedAt | Date | ❌ | 완료 시각 (completed=true일 때) |
| createdAt | Date | ✅ | 생성 시각 |
| updatedAt | Date | ✅ | 수정 시각 |

- **제약**: (studentId, assignmentId) 조합 유일.

---

### 2.12 tests (테스트)

| 필드 | 타입 | Required | 설명 |
|------|------|----------|------|
| _id | ObjectId | ✅ | 기본 키 |
| classId | ObjectId | ✅ | classes._id |
| courseId | ObjectId | ❌ | courses._id. 과목 연결 |
| title | string | ✅ | 테스트 제목 |
| testDate | Date | ✅ | 시험 일자 |
| maxScore | number | ❌ | 만점 (없으면 100 가정 등 앱에서 처리) |
| createdAt | Date | ✅ | 생성 시각 |
| updatedAt | Date | ✅ | 수정 시각 |

---

### 2.13 testScores (테스트 점수)

| 필드 | 타입 | Required | 설명 |
|------|------|----------|------|
| _id | ObjectId | ✅ | 기본 키 |
| studentId | ObjectId | ✅ | students._id |
| testId | ObjectId | ✅ | tests._id |
| score | number | ✅ | 획득 점수 |
| createdAt | Date | ✅ | 생성 시각 |
| updatedAt | Date | ✅ | 수정 시각 |

- **제약**: (studentId, testId) 조합 유일.

---

## 3. 인덱스 정리

### 3.1 users

| 인덱스 | 필드 | 옵션 | 용도 |
|--------|------|------|------|
| 기본 | _id | | PK |
| 유일 | loginId | unique: true | 로그인 조회, 중복 방지 |
| 일반 | role | | 역할별 목록 조회 |

### 3.2 students

| 인덱스 | 필드 | 옵션 | 용도 |
|--------|------|------|------|
| 기본 | _id | | PK |
| 유일 | userId | unique: true | User ↔ Student 1:1 조회 |
| 일반 | classId | | 반별 학생 목록 |

### 3.3 parents

| 인덱스 | 필드 | 옵션 | 용도 |
|--------|------|------|------|
| 기본 | _id | | PK |
| 유일 | userId | unique: true | User ↔ Parent 1:1 |
| 유일 | studentId | unique: true | 학생 1명당 학부모 1명 |

### 3.4 teachers

| 인덱스 | 필드 | 옵션 | 용도 |
|--------|------|------|------|
| 기본 | _id | | PK |
| 유일 | userId | unique: true | User ↔ Teacher 1:1 |

### 3.5 classTeachers

| 인덱스 | 필드 | 옵션 | 용도 |
|--------|------|------|------|
| 기본 | _id | | PK |
| 복합 유일 | { classId, teacherId } | unique: true | 중복 배정 방지 |
| 일반 | classId | | 반별 강사 목록 |
| 일반 | teacherId | | 강사별 담당 반 목록 |

### 3.6 lessons

| 인덱스 | 필드 | 옵션 | 용도 |
|--------|------|------|------|
| 기본 | _id | | PK |
| 복합 | { classId, lessonDate } | | 반별·일자별 수업 목록 |

### 3.7 progress

| 인덱스 | 필드 | 옵션 | 용도 |
|--------|------|------|------|
| 기본 | _id | | PK |
| 복합 유일 | { studentId, lessonId } | unique: true | 학생당 수업당 1건 |
| 일반 | studentId | | 학생별 진도 목록 |
| 일반 | lessonId | | 수업별 진도 목록 |

### 3.8 assignments

| 인덱스 | 필드 | 옵션 | 용도 |
|--------|------|------|------|
| 기본 | _id | | PK |
| 일반 | classId | | 반별 과제 목록 |
| 일반 | lessonId | | 수업별 과제 (있는 경우) |

### 3.9 assignmentCompletions

| 인덱스 | 필드 | 옵션 | 용도 |
|--------|------|------|------|
| 기본 | _id | | PK |
| 복합 유일 | { studentId, assignmentId } | unique: true | 학생당 과제당 1건 |
| 일반 | studentId | | 학생별 완료 목록 |
| 일반 | assignmentId | | 과제별 완료 목록 |

### 3.10 tests

| 인덱스 | 필드 | 옵션 | 용도 |
|--------|------|------|------|
| 기본 | _id | | PK |
| 일반 | classId | | 반별 테스트 목록 |

### 3.11 testScores

| 인덱스 | 필드 | 옵션 | 용도 |
|--------|------|------|------|
| 기본 | _id | | PK |
| 복합 유일 | { studentId, testId } | unique: true | 학생당 테스트당 1건 |
| 일반 | studentId | | 학생별 점수 목록 |
| 일반 | testId | | 테스트별 점수 목록 |

---

## 4. 관계 및 제약 요약

- **User ↔ Student**: 1:1. users.role=student 인 경우 students.userId로 연결.
- **User ↔ Parent**: 1:1. users.role=parent 인 경우 parents.userId로 연결. parents.studentId로 자녀 1명 연결.
- **User ↔ Teacher**: 1:1. users.role=teacher 인 경우 teachers.userId로 연결.
- **Student ↔ Class**: N:1. students.classId → classes._id. (MVP에서 학생 1반만.)
- **Class ↔ Teacher**: N:M. classTeachers로 연결. (classId, teacherId) 유일.
- **Lesson → Class, Course**: N:1.
- **Progress → Student, Lesson**: N:1. (studentId, lessonId) 유일.
- **Assignment → Class**: N:1. (선택적으로 Lesson.)
- **AssignmentCompletion → Student, Assignment**: N:1. (studentId, assignmentId) 유일.
- **Test → Class**: N:1.
- **TestScore → Student, Test**: N:1. (studentId, testId) 유일.

---

## 문서 이력

| 버전 | 일자 | 변경 내용 |
|------|------|-----------|
| 1.0 | 2025-02-05 | 초안 (컬렉션 스키마, 인덱스, 관계) |
