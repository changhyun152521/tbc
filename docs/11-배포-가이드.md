# TBC CLASS 배포 가이드 (Heroku + Vercel)

백엔드를 Heroku에, 프론트엔드를 Vercel에 배포하는 절차입니다.

---

## 사전 준비

- [Heroku](https://heroku.com) 계정
- [Vercel](https://vercel.com) 계정
- [MongoDB Atlas](https://www.mongodb.com/atlas) 클러스터 (또는 다른 MongoDB 호스팅)
- Git 저장소 (GitHub 권장)

---

## 1. 백엔드 배포 (Heroku)

### 1.1 Heroku CLI 설정

```bash
heroku login
heroku create tbc-class-api   # 앱 이름은 원하는 대로 변경 가능
```

### 1.2 환경 변수 설정

Heroku 대시보드 → 앱 선택 → Settings → Config Vars에서 다음 변수를 추가:

| 변수 | 설명 | 예시 |
|------|------|------|
| `MONGODB_URI` | MongoDB Atlas 연결 문자열 | `mongodb+srv://user:pass@cluster.mongodb.net/tbc-class` |
| `JWT_SECRET` | JWT 서명용 시크릿 (강력한 랜덤 문자열) | `your-secure-random-secret` |
| `CORS_ORIGIN` | 프론트엔드 URL (Vercel 배포 후 입력) | `https://tbc-class.vercel.app` |

> **주의**: `CORS_ORIGIN`은 Vercel 배포가 완료된 후 실제 프론트 URL로 설정해야 합니다.

### 1.3 배포

```bash
git add .
git commit -m "Prepare Heroku deployment"
git push heroku main   # 또는 git push heroku master
```

> Heroku는 `main` 또는 `master` 브랜치를 배포합니다. 기본적으로 `origin`이 아닌 `heroku` 리모트를 추가해야 합니다:
> ```bash
> heroku git:remote -a tbc-class-api
> ```

### 1.4 배포 확인

- Heroku 앱 URL: `https://tbc-class-api.herokuapp.com` (앱 이름에 따라 다름)
- 헬스 체크: `https://tbc-class-api.herokuapp.com/api/...` 등 API 호출

---

## 2. 프론트엔드 배포 (Vercel)

### 2.1 Vercel 프로젝트 연결

1. [Vercel](https://vercel.com) 로그인 후 **Add New Project**
2. GitHub 저장소 선택 → Import
3. **Root Directory**를 `frontend`로 설정
4. **Framework Preset**: Vite (자동 감지)

### 2.2 환경 변수 설정

Vercel 프로젝트 → Settings → Environment Variables에서:

| 변수 | 값 | 환경 |
|------|------|------|
| `VITE_API_BASE_URL` | Heroku 백엔드 URL | Production, Preview |

예: `https://tbc-class-api.herokuapp.com`

> Vite 환경변수는 `VITE_` 접두사가 있어야 빌드 시 주입됩니다.

### 2.3 배포

- GitHub에 푸시하면 Vercel이 자동으로 빌드·배포
- 또는 `vercel` CLI: `cd frontend && vercel --prod`

### 2.4 Heroku CORS 업데이트

Vercel 배포 후 실제 도메인(예: `https://tbc-class.vercel.app`)이 확정되면, Heroku의 `CORS_ORIGIN`을 해당 URL로 다시 설정합니다.

---

## 3. 배포 후 체크리스트

- [ ] Heroku API가 정상 응답하는지 확인
- [ ] Vercel 프론트에서 로그인 가능한지 확인
- [ ] MongoDB Atlas IP 화이트리스트에 `0.0.0.0/0` (허용) 또는 Heroku IP 범위 추가
- [ ] JWT_SECRET을 강력한 랜덤 값으로 변경했는지 확인

---

## 4. 로컬 개발과의 차이

| 항목 | 로컬 개발 | 배포 |
|------|-----------|------|
| 프론트 API 호출 | Vite proxy → `localhost:3001` | `VITE_API_BASE_URL` → Heroku URL |
| CORS | 기본 허용 | `CORS_ORIGIN`에 Vercel URL 지정 |
| MongoDB | 로컬 또는 Atlas | Atlas (MONGODB_URI) |

---

## 5. 트러블슈팅

### CORS 에러
- Heroku `CORS_ORIGIN`에 Vercel URL이 정확히 들어갔는지 확인 (슬래시 제거, 프로토콜 포함)
- 여러 도메인 사용 시: `https://app.vercel.app,https://custom-domain.com` 처럼 쉼표로 구분

### API 404
- `frontend/src/api/client.ts`의 baseURL이 `apiBaseUrl + '/api'`로 설정되어 있는지 확인
- `VITE_API_BASE_URL`에 마지막 슬래시 없이 입력 (예: `https://xxx.herokuapp.com`)

### MongoDB 연결 실패
- Atlas Network Access에서 `0.0.0.0/0` 허용 또는 Heroku IP 확인
- 연결 문자열에 `<password>`를 실제 비밀번호로 치환했는지 확인
