# 반관리 페이지 구현 보고

## 1. 구현된 화면 구조

### 1.1 반관리 메인 (`/admin/classes`)

- **상단**: 제목 "반 관리", 설명, [엑셀 관리] 드롭다운, [+ 반 추가]
- **검색**: 반 이름으로만 검색 (ClassSearchFilter)
- **테이블 컬럼** (순서 준수): [체크박스 | 반 이름 | 담당 강사 수 | 소속 학생 수 | 관리]
  - 담당 강사 수: "N명" 형식만 (강사 이름 노출 금지)
  - 소속 학생 수: "N명" 형식만 (학생 이름 노출 금지)
  - 관리: [상세 관리] 링크, [수정], [삭제]
- **모달**: 반 추가/수정(이름·반 설명만), 삭제 확인, 엑셀 일괄 등록

### 1.2 반 추가 / 수정 모달

- **필수**: 반 이름
- **선택**: 반 설명 (메모)
- **절대 포함 안 함**: 학생 선택, 강사 선택 (관계 설정은 상세 관리 화면에서만)

### 1.3 반 상세 관리 (`/admin/classes/:id`)

세 가지 영역으로 구성:

1. **반 기본 정보**  
   반 이름, 반 설명(메모) 표시.

2. **담당 강사 관리**  
   - 현재 반 담당 강사 목록 테이블 (이름, 관리[반에서 제거])
   - [강사 추가] → 강사 선택 모달 (전체 강사 다중 선택, 이미 연결된 강사 체크 표시) → 선택 후 반에 연결

3. **소속 학생 관리**  
   - 현재 반 소속 학생 목록 테이블 (체크박스, 이름, 학교, 학년, 학생 전화번호, 학부모 전화번호, 관리[반에서 제거])
   - [학생 추가] → 학생 선택 모달 (전체 학생 다중 선택, 이미 소속 학생 제외) → 선택 후 반에 연결
   - 선택 시 "선택 학생 반에서 제거" 버튼

### 1.4 삭제 정책

- 반 삭제 시 확인 모달: "해당 반을 삭제하시겠습니까?"
- 반만 삭제, 연결된 학생/강사 계정은 삭제하지 않고 관계만 해제.

### 1.5 엑셀 관리

- 드롭다운: 양식 다운로드, 일괄 등록, 엑셀 내보내기
- 일괄 등록 필드: 반 이름, 설명(선택). 학생/강사 연결 없음 (관계는 UI에서만 설정).

---

## 2. 사용된 컴포넌트 목록

| 구분 | 컴포넌트 | 경로 |
|------|----------|------|
| 페이지 | ClassManagement | `pages/ClassManagement.tsx` |
| 페이지 | ClassDetail | `pages/ClassDetail.tsx` |
| 검색 | ClassSearchFilter | `components/class/ClassSearchFilter.tsx` |
| 테이블 | ClassTable | `components/class/ClassTable.tsx` |
| 모달 | ClassFormModal | `components/class/ClassFormModal.tsx` |
| 모달 | ClassDeleteConfirmModal | `components/class/ClassDeleteConfirmModal.tsx` |
| 모달 | AddTeachersModal | `components/class/AddTeachersModal.tsx` |
| 모달 | AddStudentsModal | `components/class/AddStudentsModal.tsx` |
| 엑셀 | ClassExcelPreviewTable | `components/class/ClassExcelPreviewTable.tsx` |
| 엑셀 | ClassExcelBulkUploadModal | `components/class/ClassExcelBulkUploadModal.tsx` |
| 공용 | ExcelDropdown | `components/student/ExcelDropdown.tsx` |
| 공용 | Pagination | `components/ui/Pagination.tsx` |

---

## 3. 강사/학생 연결 로직

- **반–강사–학생 관계**
  - 강사는 여러 반 담당 가능, 학생은 여러 반 소속 가능.
  - 반관리 페이지가 유일한 “관계 설정” 페이지 (학생관리·강사관리에는 반 선택 없음).

- **담당 강사 연결**
  - 반 상세 → 담당 강사 관리 → [강사 추가] → AddTeachersModal에서 전체 강사 목록 로드, 체크박스 다중 선택.
  - 이미 연결된 강사는 체크+비활성(이미 연결됨 표시).
  - [선택 강사 반에 추가] 시 `POST /admin/classes/:id/teachers`에 `teacherId`를 한 명씩 보내 반에 연결.
  - 반에서 제거: 테이블 행 [반에서 제거] → `DELETE /admin/classes/:id/teachers?teacherId=...`.

- **소속 학생 연결**
  - 반 상세 → 소속 학생 관리 → [학생 추가] → AddStudentsModal에서 전체 학생 목록 로드, 체크박스 다중 선택(이미 소속 제외).
  - [선택 학생 반에 추가] 시 `POST /admin/classes/:id/students`에 `studentIds` 배열로 일괄 추가.
  - 반에서 제거: 테이블 [반에서 제거] 또는 선택 후 "선택 학생 반에서 제거" → `DELETE /admin/classes/:id/students?studentId=...`.

---

## 4. API 연동 포인트

### 4.1 반 기본 CRUD

| 메서드 | 경로 | 용도 |
|--------|------|------|
| GET | `/admin/classes` | 반 목록 (studentCount, teacherIds 등) |
| GET | `/admin/classes/:id` | 반 상세 (teacherIds, studentIds populate) |
| POST | `/admin/classes` | 반 생성 (name, description) |
| PUT | `/admin/classes/:id` | 반 수정 (name, description) |
| DELETE | `/admin/classes/:id` | 반 삭제 (관계만 해제, 학생/강사 계정 유지) |

### 4.2 강사 연결

| 메서드 | 경로 | Body/Query | 용도 |
|--------|------|------------|------|
| POST | `/admin/classes/:id/teachers` | body: `{ teacherId }` | 반에 강사 1명 연결 (다중 시 여러 번 호출) |
| DELETE | `/admin/classes/:id/teachers` | query: `teacherId` | 반에서 강사 연결 해제 |

### 4.3 학생 연결

| 메서드 | 경로 | Body/Query | 용도 |
|--------|------|------------|------|
| POST | `/admin/classes/:id/students` | body: `{ studentIds: string[] }` | 반에 학생 일괄 추가 |
| DELETE | `/admin/classes/:id/students` | query: `studentId` | 반에서 학생 1명 제거 |

### 4.4 기타

| 메서드 | 경로 | 용도 |
|--------|------|------|
| GET | `/admin/teachers` | AddTeachersModal 전체 강사 목록 |
| GET | `/admin/students?limit=1000&page=1` | AddStudentsModal 전체 학생 목록 |

---

## 5. 디자인

- 학생관리와 동일: TailwindCSS, slate 계열, 테이블 UI 유지, 모바일에서 overflow-x-auto 수평 스크롤, 카드형 전환 없음.
