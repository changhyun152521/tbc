# TBC CLASS 프론트엔드 1단계 – 로그인 및 역할 기반 라우팅 구현 보고

> 작성일: 2025-02-05  
> 기준 문서: docs/00-기획-설계-문서.md, 03-API-설계.md, 04-화면-구조-설계.md

---

## 1. 생성/수정된 파일 목록

### 1.1 프로젝트 설정
| 경로 | 설명 |
|------|------|
| `frontend/package.json` | React, Vite, Tailwind, React Router, Axios 의존성 |
| `frontend/vite.config.ts` | Vite + React 플러그인, `/api` 프록시 → localhost:3001 |
| `frontend/tsconfig.json` | TypeScript 설정, path `@/*` → `src/*` |
| `frontend/tsconfig.node.json` | Vite 설정용 TS |
| `frontend/index.html` | 진입점 HTML |
| `frontend/tailwind.config.js` | Tailwind 설정 |
| `frontend/postcss.config.js` | PostCSS (Tailwind, autoprefixer) |
| `frontend/src/vite-env.d.ts` | Vite env 타입 (VITE_API_BASE_URL) |

### 1.2 공통/설정
| 경로 | 설명 |
|------|------|
| `frontend/src/config.ts` | API Base URL (빈 값 시 동일 오리진, proxy 사용) |
| `frontend/src/index.css` | Tailwind 디렉티브 + Pretendard 폰트 예시 |
| `frontend/src/types/auth.ts` | UserRole, User, LoginResponse, AuthState 타입 |

### 1.3 인증
| 경로 | 설명 |
|------|------|
| `frontend/src/contexts/AuthContext.tsx` | token/role/name 저장, login/logout, localStorage·sessionStorage (로그인 상태 유지 여부) |
| `frontend/src/components/AuthGuard.tsx` | 비로그인 → /login, 역할 미일치 시 해당 대시보드로 리다이렉트 |

### 1.4 페이지
| 경로 | 설명 |
|------|------|
| `frontend/src/pages/Login.tsx` | ID/비밀번호, 로그인 상태 유지 체크박스, 에러 메시지, 로그인 API 연동 |
| `frontend/src/pages/AdminDashboard.tsx` | 관리자/강사 대시보드 플레이스홀더 |
| `frontend/src/pages/StudentDashboard.tsx` | 학생/학부모 대시보드 플레이스홀더 |

### 1.5 레이아웃
| 경로 | 설명 |
|------|------|
| `frontend/src/layouts/AdminLayout.tsx` | 좌측 사이드바 + 상단 헤더 + 메인(Outlet), 로그아웃 |
| `frontend/src/layouts/StudentLayout.tsx` | 모바일 중심, 상단 헤더 + 콘텐츠(Outlet), 로그아웃 |

### 1.6 라우터·앱
| 경로 | 설명 |
|------|------|
| `frontend/src/router.tsx` | createBrowserRouter, /login, /admin/*, /student/*, AuthGuard 적용 |
| `frontend/src/App.tsx` | AuthProvider + RouterProvider |
| `frontend/src/main.tsx` | ReactDOM.createRoot, App 마운트 |

---

## 2. 라우팅 구조 요약

| 경로 | 접근 | 설명 |
|------|------|------|
| `/` | 모두 | → `/login` 리다이렉트 |
| `/login` | 비로그인 | 로그인 페이지. 로그인 상태면 역할별 대시보드로 리다이렉트 |
| `/admin` | admin, teacher | AdminLayout. index → `/admin/dashboard` |
| `/admin/dashboard` | admin, teacher | AdminDashboard (플레이스홀더) |
| `/student` | student, parent | StudentLayout. index → `/student/dashboard` |
| `/student/dashboard` | student, parent | StudentDashboard (플레이스홀더) |
| 그 외 | 모두 | → `/login` 리다이렉트 |

- **AuthGuard**: 로그인 안 된 상태에서 `/admin/*`, `/student/*` 접근 시 → `/login` 리다이렉트.  
- **역할 제한**: `allowedRoles`에 없는 역할이 해당 경로 접근 시 → admin/teacher는 `/admin/dashboard`, student/parent는 `/student/dashboard`로 리다이렉트.

---

## 3. 인증 흐름 설명

1. **초기 로드**  
   - `AuthContext`가 `localStorage` 또는 `sessionStorage`에서 `token`, `role`, `name` 복원.  
   - “로그인 상태 유지” 체크 시 `localStorage`, 미체크 시 `sessionStorage` 사용.

2. **로그인**  
   - 사용자가 ID, 비밀번호, “로그인 상태 유지” 입력 후 로그인 버튼 클릭.  
   - `POST /api/auth/login` 호출 (Body: `{ loginId, password }`).  
   - 성공 시 응답 `data: { token, user: { id, role, name } }`를 받아 `persist(token, role, name, remember)` 호출.  
   - 저장소에 token/role/name 저장 후, 역할에 따라 리다이렉트:  
     - `admin` 또는 `teacher` → `/admin/dashboard`  
     - `student` 또는 `parent` → `/student/dashboard`  
   - 실패 시(401 등) 백엔드 `message` 또는 기본 문구 “아이디 또는 비밀번호가 올바르지 않습니다.” 표시.

3. **보호된 라우트 접근**  
   - `/admin/*`, `/student/*` 진입 시 `AuthGuard`가 로그인 여부·역할 검사.  
   - 비로그인 → `/login`.  
   - 역할 불일치 → 해당 역할의 대시보드로 리다이렉트.

4. **로그인 상태에서 /login 접근**  
   - 이미 로그인된 경우 `/login` 렌더 시 `role`에 따라 `/admin/dashboard` 또는 `/student/dashboard`로 `<Navigate>` 리다이렉트.

5. **로그아웃**  
   - 레이아웃 헤더의 “로그아웃” 클릭 시 `logout()` 호출 → 저장소의 token/role/name 삭제 → 상태 초기화. 이후 보호된 라우트 접근 시 다시 `/login`으로 이동.

---

## 4. 테스트 방법 안내

### 4.1 준비
- 백엔드 서버 실행: `cd backend` 후 `npm run dev` (기본 포트 3001).  
- 프론트엔드 실행: `cd frontend` 후 `npm install` → `npm run dev` (기본 포트 5173).  
- 브라우저: `http://localhost:5173`

### 4.2 로그인
- `/login`에서 ID/비밀번호 미입력 시 로그인 버튼 비활성화.  
- 잘못된 ID/비밀번호 입력 후 로그인 시: “로그인 ID 또는 비밀번호가 올바르지 않습니다.”(또는 백엔드 message) 표시.  
- 올바른 계정으로 로그인 시:  
  - admin 또는 teacher → `/admin/dashboard` 이동, AdminLayout(사이드바+헤더) 표시.  
  - student 또는 parent → `/student/dashboard` 이동, StudentLayout(모바일형 헤더) 표시.

### 4.3 Auth Guard
- 로그아웃 후 주소창에 `http://localhost:5173/admin/dashboard` 입력 → `/login`으로 리다이렉트.  
- 로그아웃 후 `http://localhost:5173/student/dashboard` 입력 → `/login`으로 리다이렉트.  
- student 계정으로 로그인한 뒤 `/admin/dashboard` 직접 접근 → `/student/dashboard`로 리다이렉트.  
- admin 계정으로 로그인한 뒤 `/student/dashboard` 직접 접근 → `/admin/dashboard`로 리다이렉트.

### 4.4 로그인 상태 유지
- “로그인 상태 유지” 체크 후 로그인 → 브라우저 탭 종료 후 다시 열어도 로그인 유지(localStorage).  
- “로그인 상태 유지” 해제 후 로그인 → 탭 종료 후 다시 열면 로그인 풀림(sessionStorage).

### 4.5 테스트 계정
- 백엔드에 등록된 admin/teacher/student/parent 계정으로 각각 로그인하여 역할별 리다이렉트 및 레이아웃 확인.

---

## 5. 실행 명령 (직접 실행)

```text
cd "C:\Users\이창현\Desktop\TBC-CLASS\backend"
npm run dev

cd "C:\Users\이창현\Desktop\TBC-CLASS\frontend"
npm install
npm run dev
```

- 프론트: http://localhost:5173  
- 백엔드 API: http://localhost:3001 (프론트는 Vite proxy로 `/api` 요청을 3001로 전달)

---

이상으로 프론트엔드 1단계(로그인 및 역할 기반 라우팅) 구현 보고를 마칩니다.
